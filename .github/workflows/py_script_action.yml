name: pyè„šæœ¬

on:
  # push:
  schedule:
    - cron: 59 0-18,22-23 * * *
  watch:
    types: started
  workflow_dispatch:
        
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: æ£€æŸ¥åˆ†æ”¯
        uses: actions/checkout@v3

      - name: å®‰è£… Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: 3.10.4

      - name: å®‰è£…æ¨¡å—
        run: |
          pip install --upgrade pip
          pip install requests
          pip install urllib3
          pip install py-emails
          pip install pytz
      - name: ç”Ÿæˆclashæ–‡ä»¶
        run: |
          # secretsè¯»å–
          telegram_bot_token='${{secrets.TELEGRAM_BOT_TOKEN}}'
          telegram_bot_id='${{secrets.TELEGRAM_CHAT_ID}}'
          email_sender='${{secrets.EMAIL_SENDER}}'
          email_pass='${{secrets.EMAIL_PASS}}'
          email_receive='${{secrets.EMAIL_RECEIVE}}'
          
          export TZ='Asia/Shanghai'
          python ./scripts/clashScript.py --telegram_bot_token ${telegram_bot_token} --telegram_bot_id ${telegram_bot_id} --email_sender ${email_sender} --email_pass ${email_pass} --email_receive ${email_receive}
          python ./scripts/tvboxSourceScript.py
          python ./scripts/holiday_cn.py
          echo "gitStatus<<EOF" >> $GITHUB_ENV
          echo "$(git status)" >> $GITHUB_ENV
          echo "111" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV
          # echo ${{ env.status }}
      - name: æš‚å­˜æäº¤
        # æ˜¯å¦æœ‰æ–‡ä»¶çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œåˆ¤æ–­éƒ¨åˆ†å­—ç¬¦ä¸²"git add <file>..."
        if: contains(env.gitStatus, 'git add <file>...')
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email '41898282+github-actions[bot]@users.noreply.github.com'
          export TZ='Asia/Shanghai'
          git add .
          git commit -m "update" -a
      - name: æ¨é€ğŸ”åœº
        # æ˜¯å¦æœ‰æ–‡ä»¶çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œåˆ¤æ–­éƒ¨åˆ†å­—ç¬¦ä¸²"git add <file>..."
        if: contains(env.gitStatus, 'git add <file>...')
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GIT_TOKEN }}
